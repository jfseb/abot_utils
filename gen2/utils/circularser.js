/**
 * (c) gerd forstmann 2017
 */
'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

Object.defineProperty(exports, "__esModule", { value: true });
var JSONx = require('circular-json');
var fs = require("fs");
var debug = require("debug");
var zlib = require("zlib");
var debuglog = debug('circularser');
function zipData(data) {
    var r = zlib.deflateSync(Buffer.from(data, 'utf-8'));
    //console.log("here r" + typeof r + " r" + r.length + " to string" + r.toString().length);
    var k = zlib.inflateSync(r);
    //  var k = zlib.inflateSync(Buffer.from(r.toString()));
    return r;
}
function unzipData(r) {
    //console.log("here data  " + typeof r + " r" + r.length + " to string" + r.toString().length);
    r = new Buffer(r, 'binary');
    //console.log("here data  " + typeof r + " r" + r.length + " to string" + r.toString().length);
    return zlib.inflateSync(r).toString();
}
/* this from http://stackoverflow.com/questions/12075927/serialization-of-regexp */
function replacer(key, value) {
    if (value instanceof RegExp) return "__REGEXP " + value.toString();else return value;
}
function reviver(key, value) {
    if (value && value.toString().indexOf("__REGEXP ") == 0) {
        var m = value.split("__REGEXP ")[1].match(/\/(.*)\/(.*)?/);
        return new RegExp(m[1], m[2] || "");
    } else return value;
}
//console.logJSON.parse(JSON.stringify(obj, replacer, 2), reviver));
function stringify(obj) {
    var s = JSONx.stringify(obj, replacer);
    return s;
}
exports.stringify = stringify;
function parse(s) {
    var obj;
    try {
        obj = JSONx.parse(s, reviver);
    } catch (e) {
        //console.log("here e" + e);
        return undefined;
    }
    return obj;
}
exports.parse = parse;
function save(fn, obj) {
    var s = stringify(obj);
    var u = zipData(s);
    fs.writeFileSync(fn + ".zip", u, 'binary'); // { encoding : 'utf-8'});
}
exports.save = save;
function load(fn) {
    var obj;
    try {
        debuglog("read file " + fn);
        var d = fs.readFileSync(fn + ".zip", 'binary'); // utf-8'); //utf-8');
        debuglog("start unzip : " + (typeof d === 'undefined' ? 'undefined' : _typeof(d)) + " length ? " + ('' + d).length);
        var s = '' + unzipData(d);
        debuglog('loaded file' + s.length);
        debuglog("end unzip");
        if (global && global.gc) {
            global.gc();
        }
        obj = parse(s);
        if (global && global.gc) {
            global.gc();
        }
        debuglog("end parse");
    } catch (e) {
        debuglog('here e :' + e);
        return undefined;
    }
    return obj;
}
exports.load = load;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy9jaXJjdWxhcnNlci50cyIsInV0aWxzL2NpcmN1bGFyc2VyLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiSlNPTngiLCJyZXF1aXJlIiwiZnMiLCJkZWJ1ZyIsInpsaWIiLCJkZWJ1Z2xvZyIsInppcERhdGEiLCJkYXRhIiwiciIsImRlZmxhdGVTeW5jIiwiQnVmZmVyIiwiZnJvbSIsImsiLCJpbmZsYXRlU3luYyIsInVuemlwRGF0YSIsInRvU3RyaW5nIiwicmVwbGFjZXIiLCJrZXkiLCJSZWdFeHAiLCJyZXZpdmVyIiwiaW5kZXhPZiIsIm0iLCJzcGxpdCIsIm1hdGNoIiwic3RyaW5naWZ5Iiwib2JqIiwicyIsInBhcnNlIiwiZSIsInVuZGVmaW5lZCIsInNhdmUiLCJmbiIsInUiLCJ3cml0ZUZpbGVTeW5jIiwibG9hZCIsImQiLCJyZWFkRmlsZVN5bmMiLCJsZW5ndGgiLCJnbG9iYWwiLCJnYyJdLCJtYXBwaW5ncyI6IkFBQUE7OztBQUdBOzs7O0FDQ0FBLE9BQU9DLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDLEVBQUVDLE9BQU8sSUFBVCxFQUE3QztBRENBLElBQUlDLFFBQVFDLFFBQVEsZUFBUixDQUFaO0FBRUEsSUFBQUMsS0FBQUQsUUFBQSxJQUFBLENBQUE7QUFDQSxJQUFBRSxRQUFBRixRQUFBLE9BQUEsQ0FBQTtBQUVBLElBQUFHLE9BQUFILFFBQUEsTUFBQSxDQUFBO0FBRUEsSUFBTUksV0FBV0YsTUFBTSxhQUFOLENBQWpCO0FBR0EsU0FBQUcsT0FBQSxDQUFpQkMsSUFBakIsRUFBOEI7QUFDMUIsUUFBSUMsSUFBSUosS0FBS0ssV0FBTCxDQUFpQkMsT0FBT0MsSUFBUCxDQUFZSixJQUFaLEVBQWlCLE9BQWpCLENBQWpCLENBQVI7QUFDQTtBQUNBLFFBQUlLLElBQUlSLEtBQUtTLFdBQUwsQ0FBaUJMLENBQWpCLENBQVI7QUFDRDtBQUND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QUFPQyxTQUFQO0FBQ0g7QUFDRCxXQUFPSixHQUFQO0FBQ0g7QUF0QkQzQixRQUFBb0MsSUFBQSxHQUFBQSxJQUFBIiwiZmlsZSI6InV0aWxzL2NpcmN1bGFyc2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiAoYykgZ2VyZCBmb3JzdG1hbm4gMjAxN1xuICovXG4ndXNlIHN0cmljdCc7XG5cbnZhciBKU09OeCA9IHJlcXVpcmUoJ2NpcmN1bGFyLWpzb24nKTtcblxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnZGVidWcnO1xuXG5pbXBvcnQgKiBhcyB6bGliIGZyb20gJ3psaWInO1xuXG5jb25zdCBkZWJ1Z2xvZyA9IGRlYnVnKCdjaXJjdWxhcnNlcicpO1xuXG5cbmZ1bmN0aW9uIHppcERhdGEoZGF0YSA6IHN0cmluZykgIDogQnVmZmVyIHtcbiAgICB2YXIgciA9IHpsaWIuZGVmbGF0ZVN5bmMoQnVmZmVyLmZyb20oZGF0YSwndXRmLTgnKSk7XG4gICAgLy9jb25zb2xlLmxvZyhcImhlcmUgclwiICsgdHlwZW9mIHIgKyBcIiByXCIgKyByLmxlbmd0aCArIFwiIHRvIHN0cmluZ1wiICsgci50b1N0cmluZygpLmxlbmd0aCk7XG4gICAgdmFyIGsgPSB6bGliLmluZmxhdGVTeW5jKHIpO1xuICAgLy8gIHZhciBrID0gemxpYi5pbmZsYXRlU3luYyhCdWZmZXIuZnJvbShyLnRvU3RyaW5nKCkpKTtcbiAgICByZXR1cm4gcjtcbn1cblxuZnVuY3Rpb24gdW56aXBEYXRhKHIgOiBhbnkpIDogc3RyaW5nIHtcbiAgICAvL2NvbnNvbGUubG9nKFwiaGVyZSBkYXRhICBcIiArIHR5cGVvZiByICsgXCIgclwiICsgci5sZW5ndGggKyBcIiB0byBzdHJpbmdcIiArIHIudG9TdHJpbmcoKS5sZW5ndGgpO1xuICAgIHIgPSBuZXcgQnVmZmVyKHIsICdiaW5hcnknKTtcbiAgICAgIC8vY29uc29sZS5sb2coXCJoZXJlIGRhdGEgIFwiICsgdHlwZW9mIHIgKyBcIiByXCIgKyByLmxlbmd0aCArIFwiIHRvIHN0cmluZ1wiICsgci50b1N0cmluZygpLmxlbmd0aCk7XG4gICAgcmV0dXJuIHpsaWIuaW5mbGF0ZVN5bmMocikudG9TdHJpbmcoKTtcbn1cblxuLyogdGhpcyBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTIwNzU5Mjcvc2VyaWFsaXphdGlvbi1vZi1yZWdleHAgKi9cbmZ1bmN0aW9uIHJlcGxhY2VyKGtleSwgdmFsdWUpIHtcbiAgaWYgKHZhbHVlIGluc3RhbmNlb2YgUmVnRXhwKVxuICAgIHJldHVybiAoXCJfX1JFR0VYUCBcIiArIHZhbHVlLnRvU3RyaW5nKCkpO1xuICBlbHNlXG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiByZXZpdmVyKGtleSwgdmFsdWUpIHtcbiAgaWYgKHZhbHVlICYmIHZhbHVlLnRvU3RyaW5nKCkuaW5kZXhPZihcIl9fUkVHRVhQIFwiKSA9PSAwKSB7XG4gICAgdmFyIG0gPSB2YWx1ZS5zcGxpdChcIl9fUkVHRVhQIFwiKVsxXS5tYXRjaCgvXFwvKC4qKVxcLyguKik/Lyk7XG4gICAgcmV0dXJuIG5ldyBSZWdFeHAobVsxXSwgbVsyXSB8fCBcIlwiKTtcbiAgfSBlbHNlXG4gICAgcmV0dXJuIHZhbHVlO1xufVxuXG4vL2NvbnNvbGUubG9nSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvYmosIHJlcGxhY2VyLCAyKSwgcmV2aXZlcikpO1xuXG5leHBvcnQgZnVuY3Rpb24gc3RyaW5naWZ5KG9iajogYW55KSA6IHN0cmluZyB7XG4gICAgdmFyIHMgPSBKU09OeC5zdHJpbmdpZnkob2JqLCByZXBsYWNlcik7XG4gICAgcmV0dXJuIHM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBwYXJzZShzOiBzdHJpbmcpIDogYW55IHtcbiAgICB2YXIgb2JqO1xuICAgIHRyeSB7XG4gICAgICAgIG9iaiA9IEpTT054LnBhcnNlKHMsIHJldml2ZXIpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImhlcmUgZVwiICsgZSk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYXZlKGZuIDogc3RyaW5nLCBvYmo6IGFueSkgOiB2b2lkIHtcbiAgICB2YXIgcyA9IHN0cmluZ2lmeShvYmopO1xuXG4gICAgdmFyIHUgPSB6aXBEYXRhKHMpO1xuICAgIGZzLndyaXRlRmlsZVN5bmMoZm4gKyBcIi56aXBcIiwgdSwgICdiaW5hcnknKTsgLy8geyBlbmNvZGluZyA6ICd1dGYtOCd9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvYWQoZm46IHN0cmluZykge1xuICAgIHZhciBvYmo7XG4gICAgdHJ5IHtcbiAgICAgICAgZGVidWdsb2coXCJyZWFkIGZpbGUgXCIgKyBmbik7XG4gICAgICAgIHZhciBkID0gIGZzLnJlYWRGaWxlU3luYyhmbiArIFwiLnppcFwiLCAnYmluYXJ5Jyk7IC8vIHV0Zi04Jyk7IC8vdXRmLTgnKTtcbiAgICAgICAgZGVidWdsb2coXCJzdGFydCB1bnppcCA6IFwiICsgKHR5cGVvZiBkKSArIFwiIGxlbmd0aCA/IFwiICsgKCcnICsgZCkubGVuZ3RoICk7XG4gICAgICAgIHZhciBzID0gJycgKyB1bnppcERhdGEoZCk7XG4gICAgICAgIGRlYnVnbG9nKCdsb2FkZWQgZmlsZScgKyBzLmxlbmd0aCk7XG4gICAgICAgIGRlYnVnbG9nKFwiZW5kIHVuemlwXCIpO1xuICAgICAgICBpZihnbG9iYWwgJiYgZ2xvYmFsLmdjKSB7XG4gICAgICAgICAgICBnbG9iYWwuZ2MoKTtcbiAgICAgICAgfVxuICAgICAgICBvYmogPSBwYXJzZShzKTtcbiAgICAgICAgaWYoZ2xvYmFsICYmIGdsb2JhbC5nYykge1xuICAgICAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgICAgIH1cbiAgICAgICAgZGVidWdsb2coXCJlbmQgcGFyc2VcIik7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBkZWJ1Z2xvZygnaGVyZSBlIDonICtlKTtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbn1cbiIsIi8qKlxuICogKGMpIGdlcmQgZm9yc3RtYW5uIDIwMTdcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xudmFyIEpTT054ID0gcmVxdWlyZSgnY2lyY3VsYXItanNvbicpO1xudmFyIGZzID0gcmVxdWlyZShcImZzXCIpO1xudmFyIGRlYnVnID0gcmVxdWlyZShcImRlYnVnXCIpO1xudmFyIHpsaWIgPSByZXF1aXJlKFwiemxpYlwiKTtcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdjaXJjdWxhcnNlcicpO1xuZnVuY3Rpb24gemlwRGF0YShkYXRhKSB7XG4gICAgdmFyIHIgPSB6bGliLmRlZmxhdGVTeW5jKEJ1ZmZlci5mcm9tKGRhdGEsICd1dGYtOCcpKTtcbiAgICAvL2NvbnNvbGUubG9nKFwiaGVyZSByXCIgKyB0eXBlb2YgciArIFwiIHJcIiArIHIubGVuZ3RoICsgXCIgdG8gc3RyaW5nXCIgKyByLnRvU3RyaW5nKCkubGVuZ3RoKTtcbiAgICB2YXIgayA9IHpsaWIuaW5mbGF0ZVN5bmMocik7XG4gICAgLy8gIHZhciBrID0gemxpYi5pbmZsYXRlU3luYyhCdWZmZXIuZnJvbShyLnRvU3RyaW5nKCkpKTtcbiAgICByZXR1cm4gcjtcbn1cbmZ1bmN0aW9uIHVuemlwRGF0YShyKSB7XG4gICAgLy9jb25zb2xlLmxvZyhcImhlcmUgZGF0YSAgXCIgKyB0eXBlb2YgciArIFwiIHJcIiArIHIubGVuZ3RoICsgXCIgdG8gc3RyaW5nXCIgKyByLnRvU3RyaW5nKCkubGVuZ3RoKTtcbiAgICByID0gbmV3IEJ1ZmZlcihyLCAnYmluYXJ5Jyk7XG4gICAgLy9jb25zb2xlLmxvZyhcImhlcmUgZGF0YSAgXCIgKyB0eXBlb2YgciArIFwiIHJcIiArIHIubGVuZ3RoICsgXCIgdG8gc3RyaW5nXCIgKyByLnRvU3RyaW5nKCkubGVuZ3RoKTtcbiAgICByZXR1cm4gemxpYi5pbmZsYXRlU3luYyhyKS50b1N0cmluZygpO1xufVxuLyogdGhpcyBmcm9tIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTIwNzU5Mjcvc2VyaWFsaXphdGlvbi1vZi1yZWdleHAgKi9cbmZ1bmN0aW9uIHJlcGxhY2VyKGtleSwgdmFsdWUpIHtcbiAgICBpZiAodmFsdWUgaW5zdGFuY2VvZiBSZWdFeHApXG4gICAgICAgIHJldHVybiAoXCJfX1JFR0VYUCBcIiArIHZhbHVlLnRvU3RyaW5nKCkpO1xuICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIHZhbHVlO1xufVxuZnVuY3Rpb24gcmV2aXZlcihrZXksIHZhbHVlKSB7XG4gICAgaWYgKHZhbHVlICYmIHZhbHVlLnRvU3RyaW5nKCkuaW5kZXhPZihcIl9fUkVHRVhQIFwiKSA9PSAwKSB7XG4gICAgICAgIHZhciBtID0gdmFsdWUuc3BsaXQoXCJfX1JFR0VYUCBcIilbMV0ubWF0Y2goL1xcLyguKilcXC8oLiopPy8pO1xuICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChtWzFdLCBtWzJdIHx8IFwiXCIpO1xuICAgIH1cbiAgICBlbHNlXG4gICAgICAgIHJldHVybiB2YWx1ZTtcbn1cbi8vY29uc29sZS5sb2dKU09OLnBhcnNlKEpTT04uc3RyaW5naWZ5KG9iaiwgcmVwbGFjZXIsIDIpLCByZXZpdmVyKSk7XG5mdW5jdGlvbiBzdHJpbmdpZnkob2JqKSB7XG4gICAgdmFyIHMgPSBKU09OeC5zdHJpbmdpZnkob2JqLCByZXBsYWNlcik7XG4gICAgcmV0dXJuIHM7XG59XG5leHBvcnRzLnN0cmluZ2lmeSA9IHN0cmluZ2lmeTtcbmZ1bmN0aW9uIHBhcnNlKHMpIHtcbiAgICB2YXIgb2JqO1xuICAgIHRyeSB7XG4gICAgICAgIG9iaiA9IEpTT054LnBhcnNlKHMsIHJldml2ZXIpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwiaGVyZSBlXCIgKyBlKTtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gICAgcmV0dXJuIG9iajtcbn1cbmV4cG9ydHMucGFyc2UgPSBwYXJzZTtcbmZ1bmN0aW9uIHNhdmUoZm4sIG9iaikge1xuICAgIHZhciBzID0gc3RyaW5naWZ5KG9iaik7XG4gICAgdmFyIHUgPSB6aXBEYXRhKHMpO1xuICAgIGZzLndyaXRlRmlsZVN5bmMoZm4gKyBcIi56aXBcIiwgdSwgJ2JpbmFyeScpOyAvLyB7IGVuY29kaW5nIDogJ3V0Zi04J30pO1xufVxuZXhwb3J0cy5zYXZlID0gc2F2ZTtcbmZ1bmN0aW9uIGxvYWQoZm4pIHtcbiAgICB2YXIgb2JqO1xuICAgIHRyeSB7XG4gICAgICAgIGRlYnVnbG9nKFwicmVhZCBmaWxlIFwiICsgZm4pO1xuICAgICAgICB2YXIgZCA9IGZzLnJlYWRGaWxlU3luYyhmbiArIFwiLnppcFwiLCAnYmluYXJ5Jyk7IC8vIHV0Zi04Jyk7IC8vdXRmLTgnKTtcbiAgICAgICAgZGVidWdsb2coXCJzdGFydCB1bnppcCA6IFwiICsgKHR5cGVvZiBkKSArIFwiIGxlbmd0aCA/IFwiICsgKCcnICsgZCkubGVuZ3RoKTtcbiAgICAgICAgdmFyIHMgPSAnJyArIHVuemlwRGF0YShkKTtcbiAgICAgICAgZGVidWdsb2coJ2xvYWRlZCBmaWxlJyArIHMubGVuZ3RoKTtcbiAgICAgICAgZGVidWdsb2coXCJlbmQgdW56aXBcIik7XG4gICAgICAgIGlmIChnbG9iYWwgJiYgZ2xvYmFsLmdjKSB7XG4gICAgICAgICAgICBnbG9iYWwuZ2MoKTtcbiAgICAgICAgfVxuICAgICAgICBvYmogPSBwYXJzZShzKTtcbiAgICAgICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgICAgIGdsb2JhbC5nYygpO1xuICAgICAgICB9XG4gICAgICAgIGRlYnVnbG9nKFwiZW5kIHBhcnNlXCIpO1xuICAgIH1cbiAgICBjYXRjaCAoZSkge1xuICAgICAgICBkZWJ1Z2xvZygnaGVyZSBlIDonICsgZSk7XG4gICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICAgIHJldHVybiBvYmo7XG59XG5leHBvcnRzLmxvYWQgPSBsb2FkO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
