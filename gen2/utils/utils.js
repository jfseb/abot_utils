'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

Object.defineProperty(exports, "__esModule", { value: true });
function deepFreeze(o) {
    if ((typeof o === "undefined" ? "undefined" : _typeof(o)) === "object") {
        Object.keys(o).forEach(function (sKey) {
            deepFreeze(o[sKey]);
        });
        Object.freeze(o);
    }
}
exports.deepFreeze = deepFreeze;
function listToQuotedCommaWord(list, quote, word) {
    quote = quote || "";
    if (list.length === 0) {
        return quote + quote;
    }
    var base = list.slice(0, list.length - 1).join(quote + ", " + quote);
    if (base) {
        base = quote + base + quote + ' ' + word + ' ' + quote + list[list.length - 1] + quote;
        return base;
    }
    return quote + list[0] + quote;
}
exports.listToQuotedCommaWord = listToQuotedCommaWord;
function listToCommaAnd(list, quote) {
    return listToQuotedCommaWord(list, quote, 'and');
}
exports.listToCommaAnd = listToCommaAnd;
function listToCommaOr(list, quote) {
    return listToQuotedCommaWord(list, '', 'or');
}
exports.listToCommaOr = listToCommaOr;
function listToQuotedCommaAnd(list) {
    return listToQuotedCommaWord(list, '"', 'and');
}
exports.listToQuotedCommaAnd = listToQuotedCommaAnd;
function listToQuotedCommaOr(list) {
    return listToQuotedCommaWord(list, '"', 'or');
}
exports.listToQuotedCommaOr = listToQuotedCommaOr;
function stripQuotes(str) {
    if (str.length > 2 && str.charAt(0) === '"' && str.charAt(str.length - 1) === '"') {
        return str.substring(1, str.length - 1);
    }
    return str;
}
exports.stripQuotes = stripQuotes;
// courtesy of
// http://stackoverflow.com/questions/4459928/how-to-deep-clone-in-javascript
function cloneDeep(item) {
    if (!item) {
        return item;
    } // null, undefined values check
    var types = [Number, String, Boolean],
        result;
    // normalizing primitives if someone did new String('aaa'), or new Number('444');
    types.forEach(function (type) {
        if (item instanceof type) {
            result = type(item);
        }
    });
    if (typeof result == "undefined") {
        if (Object.prototype.toString.call(item) === "[object Array]") {
            result = [];
            item.forEach(function (child, index, array) {
                result[index] = cloneDeep(child);
            });
        } else if ((typeof item === 'undefined' ? 'undefined' : typeof item === "undefined" ? "undefined" : _typeof(item)) == "object") {
            // testing that this is DOM
            if (!item.prototype) {
                if (item instanceof Date) {
                    result = new Date(item);
                } else {
                    // it is an object literal
                    result = {};
                    for (var i in item) {
                        result[i] = cloneDeep(item[i]);
                    }
                }
            } else {
                // depending what you would like here,
                //   // just keep the reference, or create new object
                //   if (false && item.constructor) {
                // would not advice to do that, reason? Read below
                //        result = new item.constructor();
                //    } else {
                result = item;
            }
        } else {
            result = item;
        }
    }
    return result;
}
exports.cloneDeep = cloneDeep;
exports.ArrayUtils = {
    indexOf: function indexOf(oMember, aArr, fnComp) {
        fnComp = fnComp || function (a, b) {
            return a === b;
        };
        var resIndex = -1;
        aArr.every(function (oMemberArr, index) {
            var u = fnComp(oMemberArr, oMember);
            if (u) {
                resIndex = index;
                return false;
            }
            return true;
        });
        return resIndex;
    },
    presentIn: function presentIn(oMember, aArr, fnComp) {
        return exports.ArrayUtils.indexOf(oMember, aArr, fnComp) >= 0;
    },
    setMinus: function setMinus(aRR1, aRR2, fnComp) {
        fnComp = fnComp || function (a, b) {
            return a === b;
        };
        return aRR1.reduce(function (Result, oMember, index) {
            if (!exports.ArrayUtils.presentIn(oMember, aRR2, fnComp) && !exports.ArrayUtils.presentIn(oMember, Result, fnComp)) {
                Result.push(oMember);
            }
            return Result;
        }, []);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy91dGlscy50cyIsInV0aWxzL3V0aWxzLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVlcEZyZWV6ZSIsIm8iLCJrZXlzIiwiZm9yRWFjaCIsInNLZXkiLCJmcmVlemUiLCJsaXN0VG9RdW90ZWRDb21tYVdvcmQiLCJsaXN0IiwicXVvdGUiLCJ3b3JkIiwibGVuZ3RoIiwiYmFzZSIsInNsaWNlIiwiam9pbiIsImxpc3RUb0NvbW1hQW5kIiwibGlzdFRvQ29tbWFPciIsImxpc3RUb1F1b3RlZENvbW1hQW5kIiwibGlzdFRvUXVvdGVkQ29tbWFPciIsInN0cmlwUXVvdGVzIiwic3RyIiwiY2hhckF0Iiwic3Vic3RyaW5nIiwiY2xvbmVEZWVwIiwiaXRlbSIsInR5cGVzIiwiTnVtYmVyIiwiU3RyaW5nIiwiQm9vbGVhbiIsInJlc3VsdCIsInR5cGUiLCJwcm90b3R5cGUiLCJ0b1N0cmluZyIsImNhbGwiLCJjaGlsZCIsImluZGV4IiwiYXJyYXkiLCJEYXRlIiwiaSIsIkFycmF5VXRpbHMiLCJpbmRleE9mIiwib01lbWJlciIsImFBcnIiLCJmbkNvbXAiLCJhIiwiYiIsInJlc0luZGV4IiwiZXZlcnkiLCJvTWVtYmVyQXJyIiwidSIsInByZXNlbnRJbiIsInNldE1pbnVzIiwiYVJSMSIsImFSUjIiLCJyZWR1Y2UiLCJSZXN1bHQiLCJwdXNoIl0sIm1hcHBpbmdzIjoiQUFBQTs7OztBQ0NBQSxPQUFPQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QyxFQUFFQyxPQUFPLElBQVQsRUFBN0M7QURBQSxTQUFBQyxVQUFBLENBQTJCQyxDQUEzQixFQUFrQztBQUNoQyxRQUFJLFFBQU9BLENBQVAseUNBQU9BLENBQVAsT0FBYSxRQUFqQixFQUEyQjtBQUN6QkwsZUFBT00sSUFBUCxDQUFZRCxDQUFaLEVBQWVFLE9BQWYsQ0FBdUIsVUFBU0MsSUFBVCxFQUFhO0FBQ2xD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InNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmV4cG9ydCBmdW5jdGlvbiBkZWVwRnJlZXplKG8gOiBhbnkpIHtcbiAgaWYgKHR5cGVvZiBvID09PSBcIm9iamVjdFwiKSB7XG4gICAgT2JqZWN0LmtleXMobykuZm9yRWFjaChmdW5jdGlvbihzS2V5KSB7XG4gICAgICBkZWVwRnJlZXplKG9bc0tleV0pO1xuICAgIH0pO1xuICAgIE9iamVjdC5mcmVlemUobyk7XG4gIH1cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gbGlzdFRvUXVvdGVkQ29tbWFXb3JkKGxpc3QgOiBzdHJpbmdbXSwgcXVvdGUgOiBzdHJpbmcsIHdvcmQ6IHN0cmluZykge1xuICAgIHF1b3RlID0gcXVvdGUgfHwgXCJcIjtcbiAgICBpZiggbGlzdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgcmV0dXJuIHF1b3RlICsgcXVvdGU7XG4gICAgfVxuICAgIHZhciBiYXNlID0gbGlzdC5zbGljZSgwLGxpc3QubGVuZ3RoLTEpLmpvaW4ocXVvdGUgKyBcIiwgXCIgKyBxdW90ZSk7XG4gICAgaWYoYmFzZSkge1xuICAgICAgICBiYXNlID0gcXVvdGUgKyBiYXNlICsgcXVvdGUgKyAnICcgKyB3b3JkICsgJyAnICsgcXVvdGUgKyBsaXN0W2xpc3QubGVuZ3RoLTFdICsgcXVvdGU7XG4gICAgICAgIHJldHVybiBiYXNlO1xuICAgIH1cbiAgICByZXR1cm4gcXVvdGUgKyBsaXN0WzBdICsgcXVvdGU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsaXN0VG9Db21tYUFuZChsaXN0IDogc3RyaW5nW10sIHF1b3RlPyA6IHN0cmluZykge1xuICAgIHJldHVybiBsaXN0VG9RdW90ZWRDb21tYVdvcmQobGlzdCxxdW90ZSwgJ2FuZCcpO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGxpc3RUb0NvbW1hT3IobGlzdCA6IHN0cmluZ1tdLCBxdW90ZT8gOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gIGxpc3RUb1F1b3RlZENvbW1hV29yZChsaXN0LCcnLCAnb3InKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxpc3RUb1F1b3RlZENvbW1hQW5kKGxpc3QgOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiBsaXN0VG9RdW90ZWRDb21tYVdvcmQobGlzdCwnXCInLCdhbmQnKTtcbn1cbmV4cG9ydCBmdW5jdGlvbiBsaXN0VG9RdW90ZWRDb21tYU9yKGxpc3QgOiBzdHJpbmdbXSkge1xuICAgIHJldHVybiAgbGlzdFRvUXVvdGVkQ29tbWFXb3JkKGxpc3QsICdcIicsICdvcicpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3RyaXBRdW90ZXMoc3RyIDogc3RyaW5nKSA6IHN0cmluZyB7XG4gICAgaWYoc3RyLmxlbmd0aCA+IDIgJiYgc3RyLmNoYXJBdCgwKSA9PT0gJ1wiJyAmJiBzdHIuY2hhckF0KHN0ci5sZW5ndGggLSAxKSA9PT0gJ1wiJykge1xuICAgICAgICByZXR1cm4gc3RyLnN1YnN0cmluZygxLHN0ci5sZW5ndGgtMSk7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG59XG5cbi8vIGNvdXJ0ZXN5IG9mXG4vLyBodHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzQ0NTk5MjgvaG93LXRvLWRlZXAtY2xvbmUtaW4tamF2YXNjcmlwdFxuZXhwb3J0IGZ1bmN0aW9uIGNsb25lRGVlcChpdGVtIDogYW55KSA6IGFueSAge1xuICAgIGlmICghaXRlbSkge1xuICAgICAgICByZXR1cm4gaXRlbTtcbiAgICB9IC8vIG51bGwsIHVuZGVmaW5lZCB2YWx1ZXMgY2hlY2tcbiAgICB2YXIgdHlwZXMgPSBbTnVtYmVyLCBTdHJpbmcsIEJvb2xlYW5dLFxuICAgICAgICByZXN1bHQ7XG4gICAgLy8gbm9ybWFsaXppbmcgcHJpbWl0aXZlcyBpZiBzb21lb25lIGRpZCBuZXcgU3RyaW5nKCdhYWEnKSwgb3IgbmV3IE51bWJlcignNDQ0Jyk7XG4gICAgdHlwZXMuZm9yRWFjaChmdW5jdGlvbiAodHlwZSkge1xuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIHR5cGUpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IHR5cGUoaXRlbSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAodHlwZW9mIHJlc3VsdCA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLnRvU3RyaW5nLmNhbGwoaXRlbSkgPT09IFwiW29iamVjdCBBcnJheV1cIikge1xuICAgICAgICAgICAgcmVzdWx0ID0gW107XG4gICAgICAgICAgICBpdGVtLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkLCBpbmRleCwgYXJyYXkpIHtcbiAgICAgICAgICAgICAgICByZXN1bHRbaW5kZXhdID0gY2xvbmVEZWVwKGNoaWxkKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2UgaWYgKCh0eXBlb2YgaXRlbSA9PT0gJ3VuZGVmaW5lZCcgPyAndW5kZWZpbmVkJyA6IHR5cGVvZiBpdGVtKSA9PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAvLyB0ZXN0aW5nIHRoYXQgdGhpcyBpcyBET01cbiAgICAgICAgICAgIGlmICghaXRlbS5wcm90b3R5cGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0gbmV3IERhdGUoaXRlbSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gaXQgaXMgYW4gb2JqZWN0IGxpdGVyYWxcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0ID0ge307XG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gaXRlbSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2ldID0gY2xvbmVEZWVwKGl0ZW1baV0pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGRlcGVuZGluZyB3aGF0IHlvdSB3b3VsZCBsaWtlIGhlcmUsXG4gICAgICAgICAgICAgICAgLy8gICAvLyBqdXN0IGtlZXAgdGhlIHJlZmVyZW5jZSwgb3IgY3JlYXRlIG5ldyBvYmplY3RcbiAgICAgICAgICAgICAgICAvLyAgIGlmIChmYWxzZSAmJiBpdGVtLmNvbnN0cnVjdG9yKSB7XG4gICAgICAgICAgICAgICAgLy8gd291bGQgbm90IGFkdmljZSB0byBkbyB0aGF0LCByZWFzb24/IFJlYWQgYmVsb3dcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgcmVzdWx0ID0gbmV3IGl0ZW0uY29uc3RydWN0b3IoKTtcbiAgICAgICAgICAgICAgICAvLyAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGl0ZW07XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBpdGVtO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5cbnR5cGUgZm5hID0gKGEgOiBudW1iZXIsYiA6IG51bWJlcikgPT4gbnVtYmVyO1xuXG50eXBlIGZuQ29tcDxUPiA9IChhIDogVCxiIDogVCkgPT4gYm9vbGVhbjtcblxuXG5leHBvcnQgY29uc3QgQXJyYXlVdGlscyA9IHtcblxuICBpbmRleE9mIDogZnVuY3Rpb248VD4ob01lbWJlciA6IFQsIGFBcnIgOiBBcnJheTxUPiwgZm5Db21wIDogZm5Db21wPFQ+ICkgOiBudW1iZXIge1xuICAgIGZuQ29tcCA9IGZuQ29tcCB8fCBmdW5jdGlvbiAoYTpULCBiOlQpIHsgcmV0dXJuIGEgPT09IGIgfTtcbiAgICB2YXIgcmVzSW5kZXggPSAtMTtcbiAgICBhQXJyLmV2ZXJ5KGZ1bmN0aW9uIChvTWVtYmVyQXJyLCBpbmRleCkge1xuICAgICAgdmFyIHUgPSBmbkNvbXAob01lbWJlckFycixvTWVtYmVyKTtcbiAgICAgIGlmKHUpIHtcbiAgICAgICAgcmVzSW5kZXggPSBpbmRleDtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlc0luZGV4O1xuICB9LFxuXG4gIHByZXNlbnRJbiA6IGZ1bmN0aW9uPFQ+KG9NZW1iZXIgOiBULCBhQXJyIDogQXJyYXk8VD4sIGZuQ29tcD8gOiBmbkNvbXA8VD4gKSA6IGJvb2xlYW4ge1xuICAgIHJldHVybiBBcnJheVV0aWxzLmluZGV4T2Yob01lbWJlciwgYUFyciwgZm5Db21wKSA+PSAwO1xuICB9LFxuXG5cbiAgc2V0TWludXMgOiBmdW5jdGlvbjxUPihhUlIxIDogQXJyYXk8VD4sIGFSUjIgOiBBcnJheTxUPiwgZm5Db21wPyA6IGZuQ29tcDxUPikgIHtcbiAgICBmbkNvbXAgPSBmbkNvbXAgfHwgZnVuY3Rpb24gKGE6VCwgYjpUKSB7IHJldHVybiBhID09PSBiIH07XG4gICAgcmV0dXJuICBhUlIxLnJlZHVjZShmdW5jdGlvbihSZXN1bHQsIG9NZW1iZXIsIGluZGV4KSB7XG4gICAgICBpZiAoIUFycmF5VXRpbHMucHJlc2VudEluKG9NZW1iZXIsIGFSUjIsIGZuQ29tcCkgJiYgIUFycmF5VXRpbHMucHJlc2VudEluKG9NZW1iZXIsIFJlc3VsdCwgZm5Db21wKSkge1xuICAgICAgICBSZXN1bHQucHVzaChvTWVtYmVyKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBSZXN1bHQ7XG4gICAgfSxbXSBhcyBBcnJheTxUPik7XG4gIH1cbn1cbiIsIid1c2Ugc3RyaWN0Jztcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcbmZ1bmN0aW9uIGRlZXBGcmVlemUobykge1xuICAgIGlmICh0eXBlb2YgbyA9PT0gXCJvYmplY3RcIikge1xuICAgICAgICBPYmplY3Qua2V5cyhvKS5mb3JFYWNoKGZ1bmN0aW9uIChzS2V5KSB7XG4gICAgICAgICAgICBkZWVwRnJlZXplKG9bc0tleV0pO1xuICAgICAgICB9KTtcbiAgICAgICAgT2JqZWN0LmZyZWV6ZShvKTtcbiAgICB9XG59XG5leHBvcnRzLmRlZXBGcmVlemUgPSBkZWVwRnJlZXplO1xuZnVuY3Rpb24gbGlzdFRvUXVvdGVkQ29tbWFXb3JkKGxpc3QsIHF1b3RlLCB3b3JkKSB7XG4gICAgcXVvdGUgPSBxdW90ZSB8fCBcIlwiO1xuICAgIGlmIChsaXN0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gcXVvdGUgKyBxdW90ZTtcbiAgICB9XG4gICAgdmFyIGJhc2UgPSBsaXN0LnNsaWNlKDAsIGxpc3QubGVuZ3RoIC0gMSkuam9pbihxdW90ZSArIFwiLCBcIiArIHF1b3RlKTtcbiAgICBpZiAoYmFzZSkge1xuICAgICAgICBiYXNlID0gcXVvdGUgKyBiYXNlICsgcXVvdGUgKyAnICcgKyB3b3JkICsgJyAnICsgcXVvdGUgKyBsaXN0W2xpc3QubGVuZ3RoIC0gMV0gKyBxdW90ZTtcbiAgICAgICAgcmV0dXJuIGJhc2U7XG4gICAgfVxuICAgIHJldHVybiBxdW90ZSArIGxpc3RbMF0gKyBxdW90ZTtcbn1cbmV4cG9ydHMubGlzdFRvUXVvdGVkQ29tbWFXb3JkID0gbGlzdFRvUXVvdGVkQ29tbWFXb3JkO1xuZnVuY3Rpb24gbGlzdFRvQ29tbWFBbmQobGlzdCwgcXVvdGUpIHtcbiAgICByZXR1cm4gbGlzdFRvUXVvdGVkQ29tbWFXb3JkKGxpc3QsIHF1b3RlLCAnYW5kJyk7XG59XG5leHBvcnRzLmxpc3RUb0NvbW1hQW5kID0gbGlzdFRvQ29tbWFBbmQ7XG5mdW5jdGlvbiBsaXN0VG9Db21tYU9yKGxpc3QsIHF1b3RlKSB7XG4gICAgcmV0dXJuIGxpc3RUb1F1b3RlZENvbW1hV29yZChsaXN0LCAnJywgJ29yJyk7XG59XG5leHBvcnRzLmxpc3RUb0NvbW1hT3IgPSBsaXN0VG9Db21tYU9yO1xuZnVuY3Rpb24gbGlzdFRvUXVvdGVkQ29tbWFBbmQobGlzdCkge1xuICAgIHJldHVybiBsaXN0VG9RdW90ZWRDb21tYVdvcmQobGlzdCwgJ1wiJywgJ2FuZCcpO1xufVxuZXhwb3J0cy5saXN0VG9RdW90ZWRDb21tYUFuZCA9IGxpc3RUb1F1b3RlZENvbW1hQW5kO1xuZnVuY3Rpb24gbGlzdFRvUXVvdGVkQ29tbWFPcihsaXN0KSB7XG4gICAgcmV0dXJuIGxpc3RUb1F1b3RlZENvbW1hV29yZChsaXN0LCAnXCInLCAnb3InKTtcbn1cbmV4cG9ydHMubGlzdFRvUXVvdGVkQ29tbWFPciA9IGxpc3RUb1F1b3RlZENvbW1hT3I7XG5mdW5jdGlvbiBzdHJpcFF1b3RlcyhzdHIpIHtcbiAgICBpZiAoc3RyLmxlbmd0aCA+IDIgJiYgc3RyLmNoYXJBdCgwKSA9PT0gJ1wiJyAmJiBzdHIuY2hhckF0KHN0ci5sZW5ndGggLSAxKSA9PT0gJ1wiJykge1xuICAgICAgICByZXR1cm4gc3RyLnN1YnN0cmluZygxLCBzdHIubGVuZ3RoIC0gMSk7XG4gICAgfVxuICAgIHJldHVybiBzdHI7XG59XG5leHBvcnRzLnN0cmlwUXVvdGVzID0gc3RyaXBRdW90ZXM7XG4vLyBjb3VydGVzeSBvZlxuLy8gaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL3F1ZXN0aW9ucy80NDU5OTI4L2hvdy10by1kZWVwLWNsb25lLWluLWphdmFzY3JpcHRcbmZ1bmN0aW9uIGNsb25lRGVlcChpdGVtKSB7XG4gICAgaWYgKCFpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtO1xuICAgIH0gLy8gbnVsbCwgdW5kZWZpbmVkIHZhbHVlcyBjaGVja1xuICAgIHZhciB0eXBlcyA9IFtOdW1iZXIsIFN0cmluZywgQm9vbGVhbl0sIHJlc3VsdDtcbiAgICAvLyBub3JtYWxpemluZyBwcmltaXRpdmVzIGlmIHNvbWVvbmUgZGlkIG5ldyBTdHJpbmcoJ2FhYScpLCBvciBuZXcgTnVtYmVyKCc0NDQnKTtcbiAgICB0eXBlcy5mb3JFYWNoKGZ1bmN0aW9uICh0eXBlKSB7XG4gICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgdHlwZSkge1xuICAgICAgICAgICAgcmVzdWx0ID0gdHlwZShpdGVtKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmICh0eXBlb2YgcmVzdWx0ID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChpdGVtKSA9PT0gXCJbb2JqZWN0IEFycmF5XVwiKSB7XG4gICAgICAgICAgICByZXN1bHQgPSBbXTtcbiAgICAgICAgICAgIGl0ZW0uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQsIGluZGV4LCBhcnJheSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdFtpbmRleF0gPSBjbG9uZURlZXAoY2hpbGQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoKHR5cGVvZiBpdGVtID09PSAndW5kZWZpbmVkJyA/ICd1bmRlZmluZWQnIDogdHlwZW9mIGl0ZW0pID09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgIC8vIHRlc3RpbmcgdGhhdCB0aGlzIGlzIERPTVxuICAgICAgICAgICAgaWYgKCFpdGVtLnByb3RvdHlwZSkge1xuICAgICAgICAgICAgICAgIGlmIChpdGVtIGluc3RhbmNlb2YgRGF0ZSkge1xuICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBuZXcgRGF0ZShpdGVtKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGl0IGlzIGFuIG9iamVjdCBsaXRlcmFsXG4gICAgICAgICAgICAgICAgICAgIHJlc3VsdCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpIGluIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtpXSA9IGNsb25lRGVlcChpdGVtW2ldKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIC8vIGRlcGVuZGluZyB3aGF0IHlvdSB3b3VsZCBsaWtlIGhlcmUsXG4gICAgICAgICAgICAgICAgLy8gICAvLyBqdXN0IGtlZXAgdGhlIHJlZmVyZW5jZSwgb3IgY3JlYXRlIG5ldyBvYmplY3RcbiAgICAgICAgICAgICAgICAvLyAgIGlmIChmYWxzZSAmJiBpdGVtLmNvbnN0cnVjdG9yKSB7XG4gICAgICAgICAgICAgICAgLy8gd291bGQgbm90IGFkdmljZSB0byBkbyB0aGF0LCByZWFzb24/IFJlYWQgYmVsb3dcbiAgICAgICAgICAgICAgICAvLyAgICAgICAgcmVzdWx0ID0gbmV3IGl0ZW0uY29uc3RydWN0b3IoKTtcbiAgICAgICAgICAgICAgICAvLyAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJlc3VsdCA9IGl0ZW07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBpdGVtO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG59XG5leHBvcnRzLmNsb25lRGVlcCA9IGNsb25lRGVlcDtcbmV4cG9ydHMuQXJyYXlVdGlscyA9IHtcbiAgICBpbmRleE9mOiBmdW5jdGlvbiAob01lbWJlciwgYUFyciwgZm5Db21wKSB7XG4gICAgICAgIGZuQ29tcCA9IGZuQ29tcCB8fCBmdW5jdGlvbiAoYSwgYikgeyByZXR1cm4gYSA9PT0gYjsgfTtcbiAgICAgICAgdmFyIHJlc0luZGV4ID0gLTE7XG4gICAgICAgIGFBcnIuZXZlcnkoZnVuY3Rpb24gKG9NZW1iZXJBcnIsIGluZGV4KSB7XG4gICAgICAgICAgICB2YXIgdSA9IGZuQ29tcChvTWVtYmVyQXJyLCBvTWVtYmVyKTtcbiAgICAgICAgICAgIGlmICh1KSB7XG4gICAgICAgICAgICAgICAgcmVzSW5kZXggPSBpbmRleDtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXNJbmRleDtcbiAgICB9LFxuICAgIHByZXNlbnRJbjogZnVuY3Rpb24gKG9NZW1iZXIsIGFBcnIsIGZuQ29tcCkge1xuICAgICAgICByZXR1cm4gZXhwb3J0cy5BcnJheVV0aWxzLmluZGV4T2Yob01lbWJlciwgYUFyciwgZm5Db21wKSA+PSAwO1xuICAgIH0sXG4gICAgc2V0TWludXM6IGZ1bmN0aW9uIChhUlIxLCBhUlIyLCBmbkNvbXApIHtcbiAgICAgICAgZm5Db21wID0gZm5Db21wIHx8IGZ1bmN0aW9uIChhLCBiKSB7IHJldHVybiBhID09PSBiOyB9O1xuICAgICAgICByZXR1cm4gYVJSMS5yZWR1Y2UoZnVuY3Rpb24gKFJlc3VsdCwgb01lbWJlciwgaW5kZXgpIHtcbiAgICAgICAgICAgIGlmICghZXhwb3J0cy5BcnJheVV0aWxzLnByZXNlbnRJbihvTWVtYmVyLCBhUlIyLCBmbkNvbXApICYmICFleHBvcnRzLkFycmF5VXRpbHMucHJlc2VudEluKG9NZW1iZXIsIFJlc3VsdCwgZm5Db21wKSkge1xuICAgICAgICAgICAgICAgIFJlc3VsdC5wdXNoKG9NZW1iZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIFJlc3VsdDtcbiAgICAgICAgfSwgW10pO1xuICAgIH1cbn07XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
