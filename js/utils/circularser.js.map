{"version":3,"sources":["/projects/nodejs/botbuilder/abot_utils//projects/nodejs/botbuilder/abot_utils/src/../src/utils/circularser.ts"],"names":[],"mappings":"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","file":"circularser.js","sourcesContent":["/**\n * (c) gerd forstmann 2017\n */\n'use strict';\n\n\nvar JSONx = require('flatted');\n// { parse : parse, stringify : stringify };// require('flatted');\n\nimport * as fs from 'fs';\nimport * as debug from 'debug';\n\nimport * as zlib from 'zlib';\n\nconst debuglog = debug('circularser');\n\n\nfunction zipData(data : string)  : Buffer {\n    var r = zlib.deflateSync(Buffer.from(data,'utf-8'));\n    //console.log(\"here r\" + typeof r + \" r\" + r.length + \" to string\" + r.toString().length);\n    var k = zlib.inflateSync(r);\n   //  var k = zlib.inflateSync(Buffer.from(r.toString()));\n    return r;\n}\n\nfunction unzipData(r : any) : string {\n    //console.log(\"here data  \" + typeof r + \" r\" + r.length + \" to string\" + r.toString().length);\n    r = new Buffer(r, 'binary');\n      //console.log(\"here data  \" + typeof r + \" r\" + r.length + \" to string\" + r.toString().length);\n    return zlib.inflateSync(r).toString();\n}\n\n/* this from http://stackoverflow.com/questions/12075927/serialization-of-regexp */\nfunction replacer(key, value) {\n  if (value instanceof RegExp)\n    return (\"__REGEXP \" + value.toString());\n  else\n    return value;\n}\n\nfunction reviver(key, value) {\n  if (value && value.toString().indexOf(\"__REGEXP \") == 0) {\n    var m = value.split(\"__REGEXP \")[1].match(/\\/(.*)\\/(.*)?/);\n    return new RegExp(m[1], m[2] || \"\");\n  } else\n    return value;\n}\n\n//console.logJSON.parse(JSON.stringify(obj, replacer, 2), reviver));\n\nexport function stringify(obj: any) : string {\n    var s = JSONx.stringify(obj, replacer, undefined);\n    return s;\n}\n\nexport function parse(s: string) : any {\n    var obj;\n    try {\n        obj = JSONx.parse(s, reviver);\n    } catch (e) {\n        //console.log(\"here e\" + e);\n        return undefined;\n    }\n    return obj;\n}\n\nexport function save(fn : string, obj: any) : void {\n    var s = stringify(obj);\n\n    var u = zipData(s);\n    fs.writeFileSync(fn + \".zip\", u,  'binary'); // { encoding : 'utf-8'});\n}\n\nexport function load(fn: string) {\n    var obj;\n    try {\n        debuglog(\"read file \" + fn);\n        var d =  fs.readFileSync(fn + \".zip\", 'binary'); // utf-8'); //utf-8');\n        debuglog(\"start unzip : \" + (typeof d) + \" length ? \" + ('' + d).length );\n        var s = '' + unzipData(d);\n        debuglog('loaded file' + s.length);\n        debuglog(\"end unzip\");\n        if(global && global.gc) {\n            global.gc();\n        }\n        obj = parse(s);\n        if(global && global.gc) {\n            global.gc();\n        }\n        debuglog(\"end parse\");\n    } catch (e) {\n        debuglog('here e :' +e);\n        return undefined;\n    }\n    return obj;\n}\n"],"sourceRoot":"ABC"}